# 产品需求文档 (PRD): MacMeetingMind

| 版本 | 日期 | 修改人 | 备注 |
| --- | --- | --- | --- |
| v0.1 | 2024-05-21 | Monica | 初始草案 |
| v0.2 | 2024-05-21 | Jules | 细化需求 |

## 1. 产品概述 (Product Overview)

### 1.1 产品定义
**MacMeetingMind** 是一款专为 macOS 设计的本地会议助手应用。它利用本地算力进行实时语音转文字（ASR），并通过 OpenRouter API 调用云端大模型进行智能总结。旨在为 Mac 用户提供低延迟、高隐私、低成本的会议记录解决方案。

### 1.2 核心价值
- **隐私优先**：音频数据仅在本地处理，绝不上传云端。仅将脱敏后的文本发送给 OpenRouter 生成总结，确保核心数据安全。
- **原生体验**：深度适配 macOS 设计语言，利用 Apple Silicon (M系列芯片) 硬件加速，确保低功耗高性能。
- **模型自由**：打破单一模型限制，用户通过 OpenRouter 自选模型（如 Claude 3.5 Sonnet 用于高质量总结，Llama 3 用于低成本快速总结）。

---

## 2. 用户角色 (User Roles)

| 角色 | 痛点/需求 | 典型场景 |
| --- | --- | --- |
| **远程办公者** | 会议频繁，容易漏听；需要会后回顾重点。 | 参加 Zoom/Teams 会议时，开启实时字幕辅助理解，会后查看 AI 总结。 |
| **产品/开发人员** | 会议中包含大量待办事项，手动记录效率低。 | 每日站会或需求评审会，快速提取 Action Items 和决策点。 |
| **多语言用户** | 外语会议理解困难，需要辅助翻译。 | 跨国会议中，实时查看翻译字幕，降低语言障碍。 |

---

## 3. 功能需求 (Functional Requirements)

### 3.1 🔴 音频采集与处理 (Audio Capture)

| ID | 功能点 | 详细描述 | 优先级 |
| --- | --- | --- | --- |
| F-01 | **双路录音** | 支持同时录制**麦克风输入**（用户声音）和**系统音频**（会议软件声音）。系统音频录制需支持排除特定应用（如本应用自身的声音）。 | P0 |
| F-02 | **静音检测 (VAD)** | 自动检测静音片段，在无人说话时暂停转写，避免生成无效字符并节省计算资源。 | P1 |
| F-03 | **音频回显 (Passthrough)** | 在录制系统声音时，必须确保用户仍能通过扬声器或耳机正常听到声音，无延迟或回声。 | P0 |
| F-04 | **录音指示** | 在菜单栏或 Dock 图标上显示录音状态，明确提示用户当前正在录制。 | P1 |

### 3.2 ⚡ 实时转写与字幕 (Real-time ASR & Caption)

| ID | 功能点 | 详细描述 | 优先级 |
| --- | --- | --- | --- |
| F-05 | **本地离线转写** | 使用本地 Whisper 模型将语音实时转为文本。无需联网，保护隐私。支持不同大小的模型选择 (Base, Small 等)。 | P0 |
| F-06 | **实时字幕悬浮窗** | 桌面置顶的透明窗口，显示当前对话内容。支持鼠标穿透点击，避免干扰正常操作。支持拖拽移动和大小调整。 | P0 |
| F-07 | **说话人区分** | (MVP阶段) 简单区分音频来源（麦克风 vs 系统音频），标识为 "我" 和 "其他人"。后续支持声纹识别区分不同参会者。 | P1 |
| F-08 | **多语言自动识别** | 自动识别说话语言（中/英），并加载对应的 Whisper 模型进行转写。 | P1 |

### 3.3 🧠 AI 总结 (AI Summary via OpenRouter)

| ID | 功能点 | 详细描述 | 优先级 |
| --- | --- | --- | --- |
| F-09 | **API 配置管理** | 提供界面供用户输入 OpenRouter API Key，并安全存储。支持选择模型（如下拉菜单列出 Claude 3, GPT-4, Llama 3 等）。 | P0 |
| F-10 | **一键智能总结** | 会议结束后，用户点击“生成总结”，应用将文本发送至 OpenRouter API。 | P0 |
| F-11 | **自定义 Prompt** | 允许用户配置总结的提示词模板（System Prompt），例如选择“技术会议”、“商务谈判”或“通用”模板。 | P2 |
| F-12 | **结构化输出** | 总结结果需包含：一句话摘要、主要议题、待办事项 (Action Items)、详细纪要。 | P0 |

### 3.4 📂 历史记录与管理 (History)

| ID | 功能点 | 详细描述 | 优先级 |
| --- | --- | --- | --- |
| F-13 | **本地持久化存储** | 所有转写文本、录音文件（可选）和 AI 总结均存储在本地数据库中。 | P0 |
| F-14 | **全文搜索** | 支持对历史会议的转写内容和总结进行全文关键词搜索。 | P1 |
| F-15 | **导出与分享** | 支持将会议纪要导出为 Markdown, PDF 格式，或一键复制到剪贴板。 | P1 |

---

## 4. UI/UX 关键界面

### 4.1 菜单栏 App (Menu Bar)
- 常驻菜单栏，显示当前状态图标（空闲/录制中/处理中）。
- 点击图标弹出快捷菜单：开始/停止录音、显示/隐藏悬浮窗、打开主面板、设置。

### 4.2 悬浮字幕条 (Floating Widget)
- **视觉风格**：深色半透明背景，高对比度白色文字，圆角设计，类似 macOS 原生歌词显示。
- **交互设计**：
    - 鼠标悬停时显示控制按钮（暂停滚动、复制文本、关闭）。
    - 鼠标移开后自动隐藏控制按钮，仅显示文字。
    - 此时支持鼠标穿透（可选设置），不影响下方窗口操作。

### 4.3 主面板 (Main Window)
- **左侧导航**：会议历史列表（按时间倒序排列），包含日期、时长、摘要预览。
- **右侧详情区**：
    - **顶部**：会议元数据（标题、时间、参与者）。
    - **中部**：AI 总结卡片（结构化展示）。
    - **底部**：逐字稿全文，支持按时间戳回溯（如果保留了录音）。

---

## 5. 非功能需求 (Non-functional Requirements)

- **性能**：
    - 实时转写延迟控制在 1 秒以内。
    - 后台运行时，M1 芯片上的 CPU 占用率不超过 15%。
    - 内存占用不超过 500MB，防止影响其他办公软件。
- **网络**：
    - 核心转写功能完全离线可用。
    - 仅在生成总结时需要网络连接，需优雅处理网络超时和断网情况。
- **安全性**：
    - API Key 必须使用 macOS Keychain 安全存储。
    - 遵循 macOS App Sandbox 规范，请求最少必要权限（麦克风、屏幕录制）。
    - 用户数据默认不加密存储（依赖系统级加密），但可提供应用锁功能。

---

## 6. 开发 Roadmap

### Phase 1: MVP (最小可行性产品)
- [ ] 完成 macOS 基础工程搭建 (SwiftUI)。
- [ ] 实现 ScreenCaptureKit 双路录音。
- [ ] 集成 whisper.cpp 实现实时转写。
- [ ] 开发基础悬浮窗 UI。
- [ ] 实现 OpenRouter API 调用，硬编码 Prompt 生成总结。
- [ ] 本地数据存储 (SwiftData)。

### Phase 2: 增强体验
- [ ] 完善设置界面：自定义 API Key，模型选择。
- [ ] 历史记录列表与详情页 UI 优化。
- [ ] 优化 VAD 算法，提高转写准确率。
- [ ] 支持 Markdown 导出。

### Phase 3: 高级功能
- [ ] 说话人分离 (Diarization)。
- [ ] 实时翻译功能。
- [ ] 日历集成，自动根据会议日程命名记录。
- [ ] 搜索功能增强。
